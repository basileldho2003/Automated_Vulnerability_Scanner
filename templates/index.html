<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Vulnerability Scanner</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <script>
    document.addEventListener('DOMContentLoaded', (event) => {
      const message = "{{ message }}";
      if (message) {
        alert(message);
      }
    });

    function generateReport() {
      const reportList = document.getElementById('reportList');
      reportList.innerHTML = `
                {% for result in scan_results %}
                    <li>
                        <strong>Target:</strong> {{ result.target_url }}<br>
                        <strong>Type:</strong> {{ result.vulnerability_type }}<br>
                        <strong>Description:</strong> {{ result.description }}<br>
                        <strong>Remediation:</strong> {{ result.remediation }}<br>
                        <strong>Found At:</strong> {{ result.found_at }}
                    </li>
                {% endfor %}
            `;
      document.getElementById('reportPopup').style.display = 'block';
    }

    function printReport() {
      const reportContent = document.getElementById('reportContent').innerHTML;
      const originalContent = document.body.innerHTML;
      document.body.innerHTML = reportContent;
      window.print();
      document.body.innerHTML = originalContent;
      window.location.reload();
    }

    function closeReport() {
      document.getElementById('reportPopup').style.display = 'none';
    }
  </script>
  <style>
    #reportPopup {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      display: none;
    }

    #reportContent {
      background: #fff;
      padding: 20px;
      border-radius: 5px;
      width: 80%;
      max-width: 600px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .message-success {
      color: green;
    }

    .message-error {
      color: red;
    }
  </style>

</head>

<body>
  <h1>Vulnerability Scanner</h1>
  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
  <ul>
    {% for category, message in messages %}
    <li class="message-{{ 'success' if category == 'success' else 'error' }}">{{ message }}</li>
    {% endfor %}
  </ul>
  {% endif %}
  {% endwith %}
  <form action="/add_target" method="post">
    <label for="url">Target URL:</label>
    <input type="text" id="url" name="url" required>
    <button type="submit">Add Target</button>
  </form>
  <h2>Targets</h2>
  <ul>
    {% for target in targets %}
    <li>{{ target.url }} - <a href="/scan/{{ target.id }}">Scan</a></li>
    {% endfor %}
  </ul>
  <h2>Scan Results</h2>
  <ul>
    {% for result in scan_results %}
    <li>
      <strong>Target:</strong> {{ result.target_url }}<br>
      <strong>Type:</strong> {{ result.vulnerability_type }}<br>
      <strong>Description:</strong> {{ result.description }}<br>
      <strong>Remediation:</strong> {{ result.remediation }}<br>
      <strong>Found At:</strong> {{ result.found_at }}
    </li>
    {% endfor %}
  </ul>
  <button onclick="generateReport()">Generate Report</button>
  <div id="reportPopup">
    <div id="reportContent">
      <h2>Scan Report</h2>
      <ul id="reportList"></ul>
      <button onclick="printReport()">Print</button>
      <button onclick="closeReport()">Close</button>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
</body>

</html>